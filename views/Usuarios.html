<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>Tienda Genérica</title>
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="Inicio.html">Tienda Genérica</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menú
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="Usuarios.html">Usuarios</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="Clientes.html">Clientes</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4"
                            href="proveedores.html">Proveedores</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="Ventas.html">Ventas</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="Reportes.html">Reportes</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Page Header-->
    <header class="masthead" style="background-image: url('../assets/img/misiontic.jpg')">
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="page-heading">
                        <h1>MinticApp</h1>
                        <span class="subheading">USUARIOS</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="my-5">
                        <form id="usersForm" data-sb-form-api-token="API_TOKEN">
                            <div class="form-floating">
                                <input class="form-control" id="id" type="text" placeholder="Ingresa tu cedula..."
                                    data-sb-validations="required" />
                                <label for="name">Cédula</label>
                                <div class="invalid-feedback" data-sb-feedback="cedula:required">Una Cedula es
                                    requerida.</div>
                                <div class="invalid-feedback" data-sb-feedback="cedula:password">No es una Cedula
                                    valida.</div>
                            </div>
                            <div class="form-floating">
                                <input class="form-control" id="user" type="text" placeholder="Ingresa tu usuario..."
                                    data-sb-validations="required,password" />
                                <label for="usuario">Usuario</label>
                                <div class="invalid-feedback" data-sb-feedback="usuario:required">Usuario requerido.
                                </div>
                                <div class="invalid-feedback" data-sb-feedback="usuario:password">No es un usuario
                                    valido.</div>
                            </div>
                            <div class="form-floating">
                                <input class="form-control" id="name" type="text"
                                    placeholder="Ingresa tu Nombre Completo..."
                                    data-sb-validations="required,password" />
                                <label for="nombreCompleto">Nombre Completo</label>
                                <div class="invalid-feedback" data-sb-feedback="nombreCompleto:required">Un Nombre es
                                    requerido.</div>
                                <div class="invalid-feedback" data-sb-feedback="nombreCompleto:password">No es un Nombre
                                    valido.</div>
                            </div>
                            <div class="form-floating">
                                <input class="form-control" id="password" type="password"
                                    placeholder="Ingresa tu contraseña..." data-sb-validations="required,password" />
                                <label for="password">Contraseña</label>
                                <div class="invalid-feedback" data-sb-feedback="password:required">Una contraseña es
                                    requerida.</div>
                                <div class="invalid-feedback" data-sb-feedback="password:password">No es una contraseña
                                    valida.</div>
                            </div>
                            <div class="form-floating">
                                <input class="form-control" id="email" type="email"
                                    placeholder="Ingresa tu Correo Electrónico..."
                                    data-sb-validations="required,password" />
                                <label for="email">Correo Electrónico</label>
                                <div class="invalid-feedback" data-sb-feedback="email:required">Un email es requerido.
                                </div>
                                <div class="invalid-feedback" data-sb-feedback="email:password">No es un email valido.
                                </div>
                            </div>
                            <br />
                            <div class="d-none" id="submitSuccessMessage">
                                <div class="text-center mb-3">
                                    <div class="fw-bolder">Form submission successful!</div>
                                    To activate this form, sign up at
                                    <br />
                                    <a
                                        href="https://startbootstrap.com/solution/contact-forms">https://startbootstrap.com/solution/contact-forms</a>
                                </div>
                            </div>
                            <!-- Submit error message-->
                            <!---->
                            <!-- This is what your users will see when there is-->
                            <!-- an error submitting the form-->
                            <div class="d-none" id="submitErrorMessage">
                                <div class="text-center text-danger mb-3">Error sending message!</div>
                            </div>
                        </form>
                        <!-- Submit Button-->
                        <div class="" style="display: flex; justify-content: space-evenly;">
                            <button id="searchUser" class="btn btn-primary text-uppercase "
                                id="submitButton">Consultar</button>
                            <button id="createUser" class="btn btn-primary text-uppercase "
                                id="submitButton">Crear</button>
                            <button id="updateUser" class="btn btn-primary text-uppercase "
                                id="submitButton">Actualizar</button>
                            <button id="deleteUser" class="btn btn-primary text-uppercase "
                                id="submitButton">Borrar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button id="modal-generated" type="button" style="display: none;" class="btn btn-primary" onclick='openModal()'>
            Launch demo modal
        </button>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-modal="true"
            role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modal-title"></h5>
                        <button type="button" class="close" aria-label="Close" onclick="closeModal()">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div id="modal-message" class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-backdrop fade show" id="backdrop" style="display: none;"></div>
    </main>
    <!-- Footer-->
    <footer class="border-top">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item">
                            <a href="https://twitter.com/DrFSharkness" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.facebook.com/cristian.p.gomez/" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-facebook-f fa-stack-1x fa-inverse" target="_blank"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://github.com/shy019" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <div class="small text-center text-muted fst-italic">Nunca pares de aprender. <br>Copyright &copy;
                        Cristian Pérez 2021</div>
                </div>
            </div>
        </div>
    </footer>
    <script>
        function openModal() {
            document.getElementById("backdrop").style.display = "block"
            document.getElementById("exampleModal").style.display = "block"
            document.getElementById("exampleModal").classList.add("show")
        }
        function closeModal() {
            document.getElementById("backdrop").style.display = "none"
            document.getElementById("exampleModal").style.display = "none"
            document.getElementById("exampleModal").classList.remove("show")
        }
        // Get the modal
        var modal = document.getElementById('exampleModal');

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                closeModal()
            }
        }

        deleteUser.onclick = async function () {
            var id = document.getElementById("id");
            await fetch(`http://localhost:8090/mintic/tiendagenerica/deleteuser/${id.value}`, {
                method: 'DELETE',
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                redirect: 'follow', // manual, *follow, error
                referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            })
                .then(rsp => {
                    var modalgenerated = document.getElementById("modal-generated");
                    modalgenerated.click();
                    var modaltitle = document.getElementById("modal-title");
                    modaltitle.innerHTML = "Exito";
                    var modaltext = document.getElementById("modal-message");
                    modaltext.innerHTML = `Usuario eliminado con exito`;
                }).catch((e) => {
                    console.log(e)
                    var modalgenerated = document.getElementById("modal-generated");
                    modalgenerated.click();
                    var modaltitle = document.getElementById("modal-title");
                    modaltitle.innerHTML = "Error";
                    var modaltext = document.getElementById("modal-message");
                    modaltext.innerHTML = `No se pudo eliminar el usuario`;
                }
                );
        }

        updateUser.onclick = async function () {
            var elements = document.getElementById("usersForm").elements;
            var obj = {};
            for (var i = 0; i < elements.length; i++) {
                var item = elements.item(i);
                obj[item.id] = item.value;
            }
            event.preventDefault();
            //const formData = new URLSearchParams(new FormData(this));
            fetch("http://localhost:8090/mintic/tiendagenerica/edituser",
                {
                    method: 'PUT',
                    mode: 'cors', // no-cors, *cors, same-origin
                    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                    credentials: 'same-origin', // include, *same-origin, omit
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': 'http://localhost:8090',
                        'Access-Control-Allow-Credentials': 'true'
                        // 'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    redirect: 'follow', // manual, *follow, error
                    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                    body: JSON.stringify(obj)
                })
                .then(function (response) {
                    return response.text()
                }).then(function (text) {
                    var modalgenerated = document.getElementById("modal-generated");
                    modalgenerated.click();
                    var modaltitle = document.getElementById("modal-title");
                    modaltitle.innerHTML = "Exito";
                    var modaltext = document.getElementById("modal-message");
                    modaltext.innerHTML = `Usuario modificado con exito`;
                }).catch((e) => {
                    console.log(e)
                    var modalgenerated = document.getElementById("modal-generated");
                    modalgenerated.click();
                    var modaltitle = document.getElementById("modal-title");
                    modaltitle.innerHTML = "Error";
                    var modaltext = document.getElementById("modal-message");
                    modaltext.innerHTML = `No se pudo modificar el usuario`;
                });
        }

        searchUser.onclick = async function () {
            var id = document.getElementById("id");
            var user = document.getElementById("user");
            var name = document.getElementById("name");
            var email = document.getElementById("email");
            var modal = document.getElementById("myModal");
            var data;
            let count = 0;
            await fetch(`http://localhost:8090/mintic/tiendagenerica/user/${id.value}`)
                .then(response => response.json())
                .then(rsp => {
                    data = Object.values(rsp);
                    user.value = data[4];
                    name.value = data[1];
                    email.value = data[3];
                }).catch((e) => {
                    console.log(e)
                    var modalgenerated = document.getElementById("modal-generated");
                    modalgenerated.click();
                    var modaltitle = document.getElementById("modal-title");
                    modaltitle.innerHTML = "Error";
                    var modaltext = document.getElementById("modal-message");
                    modaltext.innerHTML = `Usuario no encontrado`;
                }
                );
        }

        createUser.onclick = function () {
            var elements = document.getElementById("usersForm").elements;
            var obj = {};
            for (var i = 0; i < elements.length; i++) {
                var item = elements.item(i);
                obj[item.id] = item.value;
            }
            event.preventDefault();
            //const formData = new URLSearchParams(new FormData(this));
            fetch("http://localhost:8090/mintic/tiendagenerica/saveuser",
                {
                    method: 'POST',
                    mode: 'cors', // no-cors, *cors, same-origin
                    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                    credentials: 'same-origin', // include, *same-origin, omit
                    headers: {
                        'Content-Type': 'application/json'
                        // 'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    redirect: 'follow', // manual, *follow, error
                    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                    body: JSON.stringify(obj)
                })
                .then(function (response) {
                    return response.text()
                }).then(function (text) {
                    var modalgenerated = document.getElementById("modal-generated");
                    modalgenerated.click();
                    var modaltitle = document.getElementById("modal-title");
                    modaltitle.innerHTML = "Exito";
                    var modaltext = document.getElementById("modal-message");
                    modaltext.innerHTML = `Usuario guardado con exito`;
                }).catch((e) => {
                    console.log(e)
                    var modalgenerated = document.getElementById("modal-generated");
                    modalgenerated.click();
                    var modaltitle = document.getElementById("modal-title");
                    modaltitle.innerHTML = "Error";
                    var modaltext = document.getElementById("modal-message");
                    modaltext.innerHTML = `No se pudo crear el usuario`;
                }
                );
        }

    </script>
</body>

</html>