<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <!-- Core theme CSS (includes Bootstrap)-->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>Tienda Genérica</title>
</head>

<body>

    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                    aria-label="Toggle navigation">
                    Menú
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('../assets/img/misiontic.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="page-heading">
                            <h1>MinticApp</h1>
                            <span class="subheading">Creación básica de CRUD</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <main class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="my-5">
                            <!-- * * * * * * * * * * * * * * *-->
                            <!-- * * SB Forms Contact Form * *-->
                            <!-- * * * * * * * * * * * * * * *-->
                            <!-- This form is pre-integrated with SB Forms.-->
                            <!-- To make this form functional, sign up at-->
                            <!-- https://startbootstrap.com/solution/contact-forms-->

                            <!-- to get an API token!-->
                            <div class="post-preview">
                                <h2 class="post-title">Bienvenidos a la Tienda Genérica</h2>
                                <!--<h3 class="post-subtitle">Problems look mighty small from 150 miles up</h3>-->
                                <p class="post-meta">
                                    Creado por
                                    <a href="#!">Grupo 1</a>
                                    el 04 de Septiembre de 2021
                                </p>
                            </div>
                            <form id="contactForm" data-sb-form-api-token="API_TOKEN">
                                <div class="form-floating">
                                    <input class="form-control" id="name" type="text" placeholder="Ingresa tu nombre..."
                                        data-sb-validations="required" />
                                    <label for="name">Usuario</label>
                                    <div class="invalid-feedback" data-sb-feedback="name:required">Un nombre es
                                        requerido.</div>
                                </div>
                                <div class="form-floating">
                                    <input class="form-control" id="password" type="password"
                                        placeholder="Ingresa tu contraseña..."
                                        data-sb-validations="required,password" />
                                    <label for="password">Contraseña</label>
                                    <div class="invalid-feedback" data-sb-feedback="password:required">Una contraseña es
                                        requerida.</div>
                                    <div class="invalid-feedback" data-sb-feedback="password:password">No es una
                                        contraseña valida.</div>
                                </div>
                                <br />
                                <!-- Submit success message-->
                                <!---->
                                <!-- This is what your users will see when the form-->
                                <!-- has successfully submitted-->
                                <div class="d-none" id="submitSuccessMessage">
                                    <div class="text-center mb-3">
                                        <div class="fw-bolder">Form submission successful!</div>
                                        To activate this form, sign up at
                                        <br />
                                        <a
                                            href="https://startbootstrap.com/solution/contact-forms">https://startbootstrap.com/solution/contact-forms</a>
                                    </div>
                                </div>
                                <!-- Submit error message-->
                                <!---->
                                <!-- This is what your users will see when there is-->
                                <!-- an error submitting the form-->
                                <div class="d-none" id="submitErrorMessage">
                                    <div class="text-center text-danger mb-3">Error sending message!</div>
                                </div>
                                <!-- Submit Button-->
                                <div class="" style="display: flex; justify-content: space-evenly;">
                                    <button class="btn btn-primary text-uppercase" id="submitButton" type="button"
                                        onclick="continuar()">Aceptar</button>
                                    <button class=" btn btn-primary text-uppercase" id="cancelButton" type="button"
                                        onclick="cancelar()">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <button id="modal-generated" type="button" style="display: none;" class="btn btn-primary"
                onclick='openModal()'>
                Launch demo modal
            </button>
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                aria-modal="true" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modal-title"></h5>
                            <button type="button" class="close" aria-label="Close" onclick="closeModal()">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div id="modal-message" class="modal-body">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeModal()">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-backdrop fade show" id="backdrop" style="display: none;"></div>
        </main>
        <!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="https://twitter.com/DrFSharkness" target="_blank">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.facebook.com/cristian.p.gomez/" target="_blank">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-facebook-f fa-stack-1x fa-inverse" target="_blank"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://github.com/shy019" target="_blank">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">Nunca pares de aprender. <br>Copyright
                            &copy; Cristian Pérez 2021</div>
                    </div>
                </div>
            </div>
        </footer>
        <script>
            let submitButton = document.getElementById("password");
            submitButton.addEventListener("keypress", function (event) {
                if (event.key == "Enter") {
                    continuar();
                }
            })

            let userName = document.getElementById("name");
            let password = document.getElementById("password");
            var modalgenerated = document.getElementById("modal-generated");
            var modaltitle = document.getElementById("modal-title");
            var modaltext = document.getElementById("modal-message");

            function openModal() {
                document.getElementById("backdrop").style.display = "block"
                document.getElementById("exampleModal").style.display = "block"
                document.getElementById("exampleModal").classList.add("show")
            }
            function closeModal() {
                document.getElementById("backdrop").style.display = "none"
                document.getElementById("exampleModal").style.display = "none"
                document.getElementById("exampleModal").classList.remove("show")
            }
            var modal = document.getElementById('exampleModal');

            async function continuar() {
                if (userName.value !== null && password.value !== null) {
                    var obj = {};
                    obj["username"] = userName.value;
                    obj["password"] = password.value;
                    await fetch('http://localhost:8090/api/auth/signin',
                        {
                            method: 'POST',
                            mode: 'cors', // no-cors, *cors, same-origin
                            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                            credentials: 'same-origin', // include, *same-origin, omit
                            headers: {
                                'Content-Type': 'application/json'
                                // 'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            redirect: 'follow', // manual, *follow, error
                            referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                            body: JSON.stringify(obj)
                        })
                        .then(function (response) {
                            return response.json();
                        }).then(function (text) {
                            if (text.status == 401 || text.status == 404 || text.status == 400 || text.status == 403) {
                                throw text.message;
                            }

                            localStorage.setItem("user", JSON.stringify(text));
                            //var usuarioAlmacenado = localStorage.getItem("user");
                            window.location.href = "C:/Users/david/OneDrive/Imágenes/mintic/views/Principal.html";
                        }).catch((error) => {
                            modalgenerated.click();
                            modaltitle.innerHTML = "Error";
                            modaltext.innerHTML = `${error}`;
                        })
                } else {
                    modalgenerated.click();
                    modaltitle.innerHTML = "Error";
                    if (password.value !== null) {
                        modaltext.innerHTML = `Ingrese una contraseña`;
                    } else {
                        modaltext.innerHTML = `Ingrese un usuario`;
                    }
                }
            }

            function cancelar() {
                userName.value = '';
                password.value = '';
            }
        </script>
    </body>

</html>